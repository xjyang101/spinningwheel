<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Spinning Wheel</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Economica:ital,wght@0,400;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: Arial, sans-serif;
        background: #292929;
        color: white;
      }

      h1 {
        font-family: "Economica", sans-serif;
        font-weight: 700;
        font-style: normal;
      }
      canvas {
        margin-top: 20px;
      }

      .wheel-container {
        position: relative;
      }

      .wheel-container img {
        width: 75px;
        height: 75px;
        display: flex;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);

        border-radius: 50%;
        cursor: pointer;
      }

      button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 18px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Spin the Wheel</h1>
    <div class="wheel-container">
      <canvas id="wheel" width="400" height="400"></canvas>
      <img id="spinBtn" src="logo.PNG" alt="" />
    </div>
    <p id="result"></p>

    <script>
      const canvas = document.getElementById("wheel");
      const ctx = canvas.getContext("2d");
      const resultText = document.getElementById("result");

      const center = canvas.width / 2;
      const radius = center;

      const slices = [
        { label: "No Stuff â˜¹ï¸", weight: 1.37, color: "#484848" },
        { label: "5% OFF!", weight: 1, color: "#fce02a" },
        { label: "No Stuff â˜¹ï¸", weight: 1.37, color: "#484848" },
        { label: "$5 OFF!", weight: 1, color: "#fce02a" },
        { label: "No Stuff â˜¹ï¸", weight: 1.37, color: "#484848" },
        { label: "Free pre-roll", weight: 0.55, color: "#fce02a" },
        { label: "No Stuff â˜¹ï¸", weight: 1.37, color: "#484848" },
        { label: "5% OFF!", weight: 1, color: "#fce02a" },
        { label: "No Stuff â˜¹ï¸", weight: 1.37, color: "#484848" },
        { label: "10% OFF!", weight: 1, color: "#fce02a" },
        { label: "No Stuff â˜¹ï¸", weight: 1.37, color: "#484848" },
        { label: "Free", weight: 0.175, color: "#fce02a" },
      ];

      let totalWeight = slices.reduce((sum, s) => sum + s.weight, 0);
      let currentRotation = 0;
      let spinning = false;

      // Draw wheel
      function drawWheel(rotation = 0) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        let startAngle = rotation;

        slices.forEach((slice) => {
          const sliceAngle = (slice.weight / totalWeight) * Math.PI * 2;

          ctx.beginPath();
          ctx.moveTo(center, center);
          ctx.arc(center, center, radius, startAngle, startAngle + sliceAngle);
          ctx.fillStyle = slice.color;
          ctx.fill();
          // stroke (outline)
          ctx.strokeStyle = "#000"; // or whatever color you want
          ctx.lineWidth = 2; // thickness of the border
          ctx.stroke();

          // Text
          ctx.save();
          ctx.translate(center, center);
          ctx.rotate(startAngle + sliceAngle / 2);
          ctx.textAlign = "right";
          ctx.fillStyle = "#000";
          ctx.font = "17px Economica bold";
          ctx.fillText(slice.label, radius - 10, 5);
          ctx.restore();

          startAngle += sliceAngle;
        });

        // Pointer â€“ half overhanging, half inside the wheel
        ctx.beginPath();

        // Wide base (outside the wheel)
        ctx.moveTo(center - 14, center - radius - 15); // top-left, above wheel
        ctx.lineTo(center + 14, center - radius - 15); // top-right, above wheel

        // Tip inside the wheel (about halfway toward center)
        ctx.lineTo(center, center - radius + 45); // â† this y controls how deep it goes in

        ctx.closePath();

        ctx.fillStyle = "#ffffff";
        ctx.fill();

        // Outline makes it pop
        ctx.strokeStyle = "#222";
        ctx.lineWidth = 2.5;
        ctx.stroke();
      }

      drawWheel();

      document.getElementById("spinBtn").addEventListener("click", () => {
        if (spinning) return;
        spinning = true;
        resultText.textContent = "";

        const spinAmount = Math.random() * 3000 + 3000; // random spin
        const start = performance.now();
        const duration = 3000;

        function animate(time) {
          const progress = Math.min((time - start) / duration, 1);
          const easeOut = 1 - Math.pow(1 - progress, 3);

          currentRotation = (spinAmount * easeOut * Math.PI) / 180;
          drawWheel(currentRotation);

          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            spinning = false;
            determineWinner();
          }
        }

        requestAnimationFrame(animate);
      });

      function determineWinner() {
        const TWO_PI = Math.PI * 2;

        // Adjust for pointer being at the top
        const pointerAngle =
          (TWO_PI - (currentRotation % TWO_PI) - Math.PI / 2 + TWO_PI) % TWO_PI;

        let cumulativeAngle = 0;

        for (let slice of slices) {
          const sliceAngle = (slice.weight / totalWeight) * TWO_PI;

          if (
            pointerAngle >= cumulativeAngle &&
            pointerAngle < cumulativeAngle + sliceAngle
          ) {
            if (slice.weight != 1.37) {
              const winner = new Audio("winner.mp3").play();
              resultText.textContent = `ðŸŽ‰ You got: ${slice.label}`;
              return;
            } else {
              const loser = new Audio("loser.mp3").play();
              resultText.textContent = `You got: ${slice.label}`;
            }
          }

          cumulativeAngle += sliceAngle;
        }
      }
    </script>
  </body>
</html>
